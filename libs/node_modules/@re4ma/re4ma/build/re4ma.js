var m=Object.create(null),d=new Set,H="all-imports-ready",T="--",o=class extends HTMLElement{constructor(){super();d.add(this)}applySrc(){}set src(t){!t||(m[t]?(this.srcText=m[t],this.applySrc()):window.fetch(t).then(async e=>{this.srcText=await e.text(),m[t]=this.srcText,this.applySrc()}))}getCssData(t,e=!1){if(this.__cssDataCache||(this.__cssDataCache=Object.create(null)),!Object.keys(this.__cssDataCache).includes(t)){this.__computedStyle||(this.__computedStyle=window.getComputedStyle(this));let r=this.__computedStyle.getPropertyValue(t).trim();r.startsWith("'")&&r.endsWith("'")&&(r=r.replace(/\'/g,'"'));try{this.__cssDataCache[t]=JSON.parse(r)}catch{!e&&console.warn(`CSS Data error: ${t}`),this.__cssDataCache[t]=null}}return this.__cssDataCache[t]}dropCssDataCache(){this.__cssDataCache=null,this.__computedStyle=null}async applyLoader(t){let e=this.getAttribute("loader");if(!e){console.log(`Loader error: ${e}`);return}let r=await(await window.fetch(e)).text(),i=new File([r],"loader",{type:"application/javascript"});(await import(URL.createObjectURL(i))).default(t,this)}processHtmlPlaceholders(t){return[...this.attributes].forEach(e=>{if(e.name.startsWith(T)){let r=e.name.replace(T,"");t=t.split(`{{${r}}}`).join(e.value)}}),t.includes("{{")&&t.includes("}}")&&t.split("{{").forEach(r=>{if(!r.includes("}}"))return;let i=r.split("}}")[0],l=this.getCssData(`--${i}`);l&&(t=t.split(`{{${i}}}`).join(l))}),t}processSlots(t){let e=t.querySelector("slot:not([name])"),r;[...this.children].forEach(i=>{var n;let l=i.getAttribute("slot");l&&(r=t.querySelector(`slot[name="${l}"]`)),r||(r=e||null),r?(n=r.parentElement)==null||n.insertBefore(i,r):i.remove()}),[...t.querySelectorAll("slot")].forEach(i=>{i.remove()})}disconnectedCallback(){d.delete(this),d.size||(window.dispatchEvent(new CustomEvent(H)),window.requestAnimationFrame(()=>{[...document.querySelectorAll("[re-move]")].forEach(t=>{t.remove()})}))}attributeChangedCallback(t,e,r){r!==e&&(this[t]=r)}static reg(t){window.customElements.define(t,this)}};o.observedAttributes=["src"];var c=class extends o{applySrc(){let t=this.processHtmlPlaceholders(this.srcText),e=document.createElement("template");e.innerHTML=t;let r=document.createDocumentFragment();r.appendChild(e.content),this.processSlots(r),this.parentElement.insertBefore(r,this),this.remove()}};var p=class extends o{constructor(){super();this.dataSrc=null,this.templateSrc=null}_getHtml(t,e,r=null){let i=(l,n)=>{for(let a in l)l[a].constructor===Object?i(l[a],n+a+"."):e=e.split(`{{${n+a}}}`).join(l[a])};return i(t,""),r&&(e=e.split("{{id}}").join(r)),e}async _render(){let t=await(await window.fetch(this.dataSrc)).json(),e=await(await window.fetch(this.templateSrc)).text();if(this._html="",t.constructor===Array)t.forEach(r=>{this._html+=this._getHtml(r,e)});else if(t.constructor===Object)for(let r in t)this._html+=this._getHtml(t[r],e,r);else console.log("Wrong data format at "+this.dataSrc);this.parentNode&&(this.outerHTML=this.processHtmlPlaceholders(this._html))}connectedCallback(){this.dataSrc&&this.templateSrc&&this._render()}attributeChangedCallback(t,e,r){r!==e&&(this[t.split("-")[0]+"Src"]=r)}static get observedAttributes(){return["data-src","template-src"]}};var u=class extends o{_setModule(t){let e=this.getAttribute("module");(e==="true"||e==="")&&t.setAttribute("type","module")}applySrc(){let t;this.hasAttribute("inline")?(t=document.body.querySelector("script[re-inline]"),t||(t=document.createElement("script"),t.setAttribute("re-inline",""),this._setModule(t),document.body.appendChild(t)),t.textContent+=`
`+this.srcText):(t=document.createElement("script"),t.src=this.getAttribute("src"),this._setModule(t),document.body.appendChild(t)),this.remove()}};function h(s){return s=s.replace(/;/g,"&semi;").replace(/\//g,"&sol;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),["=","#","$","|","{","}","'","`",":",".",",","(",")","[","]","&lt;&sol;","&lt;","&gt;","&semi;","&quot;"].forEach(e=>{s=s.split(e).join(`<span class="hl">${e}</span>`)}),s=s.split("&sol;*").join('<span class="comment">&sol;*').split("*&sol;").join("*&sol;</span>").split("&sol;&sol; ").map((e,r)=>r?e.replace(`
`,`</span>
`):e).join('<span class="comment">&sol;&sol; '),s}var f=class extends o{async applySrc(){let e=(await import("https://unpkg.com/@re4ma/re4ma@latest/build/mkd.esm.min.js")).marked(this.srcText),r=document.createDocumentFragment(),i=document.createElement("div");i.innerHTML=e,r.appendChild(i),[...r.querySelectorAll("code")].forEach(n=>{n.innerHTML=h(n.textContent)}),this.outerHTML=i.innerHTML}};var g=class extends o{applySrc(){if(this.hasAttribute("inline")){let t=document.querySelector("style");t||(t=document.createElement("style"),document.head.appendChild(t)),t.textContent+=this.srcText}else{let t=document.createElement("link");t.href=this.getAttribute("src"),t.rel="stylesheet",document.head.appendChild(t)}this.remove()}};var y=class extends o{set src(t){!t||this.applyLoader(t)}};var S=class extends o{set src(t){if(!!t){if(this.img=document.createElement("img"),this.hasAttribute("lazy")&&(this.img.loading="lazy"),this.hasAttribute("w")){let e=this.getAttribute("w");this.img.setAttribute("width",e),this.width=parseFloat(e)}if(this.hasAttribute("h")){let e=this.getAttribute("h");this.img.setAttribute("height",e),this.height=parseFloat(e)}this.hasAttribute("alt")&&(this.img.alt=this.getAttribute("alt")),this.hasAttribute("loader")?this.applyLoader(t):(this.img.src=t,this.parentNode.insertBefore(this.img,this),this.remove())}}};var b=class extends o{applySrc(){this.srcText&&(this.outerHTML=`<code>${h(this.srcText)}</code>`)}};var w=class extends o{connectedCallback(){let t=this.getAttribute("href");if(t){let e=document.createElement("a");for(let r of[...this.attributes])e.setAttribute(r.name,r.value);e.innerHTML=this.innerHTML,this.parentNode.insertBefore(e,this),this.remove(),window.fetch("./",{method:"POST",body:JSON.stringify({type:"link",href:t})})}}};var M=`
<div re-variant="A" hidden>
  <re-htm src="{{SRC-A}}"></re-htm>
</div>
<div re-variant="B" hidden>
  <re-htm src="{{SRC-B}}"></re-htm>
</div>
`;function _(){let s=Math.random()>.5?"A":"B";[...document.querySelectorAll("[re-variant]")].forEach(t=>{t.getAttribute("re-variant")===s?t.style.display="contents":t.style.display="none"})}var k=`
<script type="module">
  ${_.toString()};
  releaseAB();
<\/script>
`,R=!1,C=class extends o{connectedCallback(){if(!R){let e=document.createElement("template");e.innerHTML=k,document.body.appendChild(e.content.cloneNode(!0)),R=!0}let t=M.split("{{SRC-A}}").join(this.getAttribute("src-a"));t=t.split("{{SRC-B}}").join(this.getAttribute("src-b")),this.outerHTML=t,_()}};var x=class extends o{connectedCallback(){this.docSrc=this.getAttribute("doc")||"",this.tplSrc=this.getAttribute("tpl"),this.aText=this.getAttribute("text")||this.tplSrc,this.tplSrc&&(async()=>{let e=await(await window.fetch(this.tplSrc)).text(),r=await(await window.fetch(this.docSrc)).text();e=this.processHtmlPlaceholders(e),r=this.processHtmlPlaceholders(r);let i=new File([e.replace("{{CONTENT}}",r)],"test.html",{type:"text/html"}),l=`<a href="${URL.createObjectURL(i)}">${this.aText}</a>`;this.outerHTML=l})()}};var E=class extends c{};function v(){c.reg("re-htm"),E.reg("re-svg"),p.reg("re-peat"),u.reg("re-js"),f.reg("re-md"),g.reg("re-css"),S.reg("re-img"),y.reg("re-load"),b.reg("re-code"),w.reg("re-link"),C.reg("re-ab"),x.reg("re-doc")}var L="re-tpl",A=document.querySelector(`script[${L}]`);if(A){let s=A.getAttribute(L);window.fetch(s).then(async t=>{let e=await t.text();e=e.replace("{{CONTENT}}",document.body.innerHTML),[...A.attributes].forEach(i=>{if(i.name.startsWith("--")){let l=i.name.replace("--","").toUpperCase();e=e.replace(`{{${l}}}`,i.value)}});let r=document.open();r.write(e),r.close(),v(),window.requestAnimationFrame(()=>{window.addEventListener("keydown",i=>{i.key==="r"&&i.ctrlKey&&(i.preventDefault(),window.fetch("./",{method:"POST",body:JSON.stringify({type:"save",path:document.location.pathname,html:`<!DOCTYPE html>
`+document.documentElement.outerHTML})}))})})})}else v();
